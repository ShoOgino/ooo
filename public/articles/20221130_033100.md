# awsを利用してwebサイトをデプロイしてみた
## 利用した技術
- infrastructure
    - Elastic Conteiner Service(ECS)  : コンテナをデプロイするやつ
    - Elastic Container Registory(ECR): dockerイメージ置き場
    - Elastic Load Balancing(ELB)     : ロードバランサー
    - docker: サーバのコンテナ型仮想化ツール
- frontend
    - react: ビューのモジュール化を可能にするフレームワーク
    - nextjs: 開発環境の構築からデプロイまでサポートしてくれるフレームワーク
- backend
    - nodejs: OS上でのjsの実行環境
- other
    - git: バージョン管理ツール
## 手順の概要
1. dockerのimageを用意
    1. ECRにリポジトリを作成する
    2. dockerのimageを作る
    3. 2で作成したdockerのimageを、1で作成したECRのリポジトリにアップロードする
2. タスク定義(ECS上に作成するコンテナの設定)を作成
    - 下記のような項目を設定
         - デプロイ先のスペック(os, cpu, memory)
         - 利用する、dockerのimage
         - ポートフォワーディング
3. セキュリティグループ(どのプロトコル、どのipからの接続を許すか、みたいなルール)を作成
4. ロードバランサーを用意
    1. ターゲットグループ(ルーティング先の機器の集合)を設定
        1. ルーティング設定
            - プロトコル
            - どのポートで受けるか
        2. ターゲットの登録
            - 2台のサーバを登録する場合、それらにロードバランサーがリクエストを振り分ける。
            - 0台としておいて、ECSサービス作成時に追加登録することもできる
    2. 2で作成したセキュリティグループを設定
5. ECSクラスターを作成
6. ECSクラスター上にECSサービスを作成
    - 下記を設定する
        - 2で作成したタスク定義
        - 3で作成したセキュリティグループ
        - 4で作成したロードバランサー
7. ロードバランサーに与えられたDNS名へ、ブラウザでアクセスして稼働確認
## 感想
- awsのサービスは、個々の部品の疎結合が指向されており、抽象的で組み立ての自由度が高いという印象を受けた。
    - それゆえに個々の部品のドキュメントだけ見ても説明が抽象的でピンとこないことが多い。
        - qiitaとかで具体的な利用例を見ると機能のイメージが湧きやすい。
- 利用料、二日で10ドルかかっててびびった。
    - 個人サイトでawsを利用するのは割に合わなそう。
    - awsはがっつり楽してがっつり稼ぐためのサービスでは。

## 次やること
- 適当なサーバを借りて本サイトをそこに移す